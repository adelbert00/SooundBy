(function(g,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],c):(g=typeof globalThis<"u"?globalThis:g||self,c(g["vue-audio-visual"]={},g.Vue))})(this,function(g,c){"use strict";var Gt=Object.defineProperty;var Rt=(g,c,E)=>c in g?Gt(g,c,{enumerable:!0,configurable:!0,writable:!0,value:E}):g[c]=E;var l=(g,c,E)=>(Rt(g,typeof c!="symbol"?c+"":c,E),E);var E;const ie=typeof window<"u",Ke=n=>typeof n=="string",Ze=()=>{};ie&&((E=window==null?void 0:window.navigator)==null?void 0:E.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function p(n){return typeof n=="function"?n():c.unref(n)}function be(n,e=!1,t="Timeout"){return new Promise((r,i)=>{setTimeout(e?()=>i(t):r,n)})}function et(n){return n}function tt(n,...e){return e.some(t=>t in n)}function ae(){const n=[],e=i=>{const a=n.indexOf(i);a!==-1&&n.splice(a,1)};return{on:i=>(n.push(i),{off:()=>e(i)}),off:e,trigger:i=>{n.forEach(a=>a(i))}}}function oe(n){return c.getCurrentScope()?(c.onScopeDispose(n),!0):!1}function le(n){return typeof n=="function"?c.computed(n):c.ref(n)}function se(n,e=!1){function t(u,{flush:y="sync",deep:C=!1,timeout:b,throwOnTimeout:z}={}){let _=null;const $=[new Promise(D=>{_=c.watch(n,q=>{u(q)!==e&&(_==null||_(),D(q))},{flush:y,deep:C,immediate:!0})})];return b!=null&&$.push(be(b,z).then(()=>p(n)).finally(()=>_==null?void 0:_())),Promise.race($)}function r(u,y){if(!c.isRef(u))return t(q=>q===u,y);const{flush:C="sync",deep:b=!1,timeout:z,throwOnTimeout:_}=y!=null?y:{};let T=null;const D=[new Promise(q=>{T=c.watch([n,u],([L,I])=>{e!==(L===I)&&(T==null||T(),q(L))},{flush:C,deep:b,immediate:!0})})];return z!=null&&D.push(be(z,_).then(()=>p(n)).finally(()=>(T==null||T(),p(n)))),Promise.race(D)}function i(u){return t(y=>Boolean(y),u)}function a(u){return r(null,u)}function o(u){return r(void 0,u)}function f(u){return t(Number.isNaN,u)}function s(u,y){return t(C=>{const b=Array.from(C);return b.includes(u)||b.includes(p(u))},y)}function d(u){return h(1,u)}function h(u=1,y){let C=-1;return t(()=>(C+=1,C>=u),y)}return Array.isArray(p(n))?{toMatch:t,toContains:s,changed:d,changedTimes:h,get not(){return se(n,!e)}}:{toMatch:t,toBe:r,toBeTruthy:i,toBeNull:a,toBeNaN:f,toBeUndefined:o,changed:d,changedTimes:h,get not(){return se(n,!e)}}}function nt(n){return se(n)}function rt(n,e,t={}){const{immediate:r=!0}=t,i=c.ref(!1);let a=null;function o(){a&&(clearTimeout(a),a=null)}function f(){i.value=!1,o()}function s(...d){o(),i.value=!0,a=setTimeout(()=>{i.value=!1,a=null,n(...d)},p(e))}return r&&(i.value=!0,ie&&s()),oe(f),{isPending:i,start:s,stop:f}}function it(n){var e;const t=p(n);return(e=t==null?void 0:t.$el)!=null?e:t}const ce=ie?window:void 0;function B(...n){let e,t,r,i;if(Ke(n[0])||Array.isArray(n[0])?([t,r,i]=n,e=ce):[e,t,r,i]=n,!e)return Ze;Array.isArray(t)||(t=[t]),Array.isArray(r)||(r=[r]);const a=[],o=()=>{a.forEach(h=>h()),a.length=0},f=(h,u,y)=>(h.addEventListener(u,y,i),()=>h.removeEventListener(u,y,i)),s=c.watch(()=>it(e),h=>{o(),h&&a.push(...t.flatMap(u=>r.map(y=>f(h,u,y))))},{immediate:!0,flush:"post"}),d=()=>{s(),o()};return oe(d),d}const ue=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},de="__vueuse_ssr_handlers__";ue[de]=ue[de]||{},ue[de];function fe(n,e={}){const{immediate:t=!0,window:r=ce}=e,i=c.ref(!1);let a=null;function o(){!i.value||!r||(n(),a=r.requestAnimationFrame(o))}function f(){!i.value&&r&&(i.value=!0,o())}function s(){i.value=!1,a!=null&&r&&(r.cancelAnimationFrame(a),a=null)}return t&&f(),oe(s),{isActive:i,pause:s,resume:f}}var at=Object.defineProperty,ot=Object.defineProperties,lt=Object.getOwnPropertyDescriptors,Ce=Object.getOwnPropertySymbols,st=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable,Se=(n,e,t)=>e in n?at(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,v=(n,e)=>{for(var t in e||(e={}))st.call(e,t)&&Se(n,t,e[t]);if(Ce)for(var t of Ce(e))ct.call(e,t)&&Se(n,t,e[t]);return n},M=(n,e)=>ot(n,lt(e));const ut={json:"application/json",text:"text/plain",formData:"multipart/form-data"};function J(n){return tt(n,"immediate","refetch","initialData","timeout","beforeFetch","afterFetch","onFetchError","fetch")}function dt(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function R(n){return typeof Headers<"u"&&n instanceof Headers?Object.fromEntries([...n.entries()]):n}function G(n,...e){return n==="overwrite"?async t=>{const r=e[e.length-1];return r!==void 0&&await r(t),t}:async t=>(await e.reduce((r,i)=>r.then(async()=>{i&&(t=v(v({},t),await i(t)))}),Promise.resolve()),t)}function ft(n={}){const e=n.combination||"chain",t=n.options||{},r=n.fetchOptions||{};function i(a,...o){const f=c.computed(()=>{const h=p(n.baseUrl),u=p(a);return h&&!dt(u)?mt(h,u):u});let s=t,d=r;return o.length>0&&(J(o[0])?s=M(v(v({},s),o[0]),{beforeFetch:G(e,t.beforeFetch,o[0].beforeFetch),afterFetch:G(e,t.afterFetch,o[0].afterFetch),onFetchError:G(e,t.onFetchError,o[0].onFetchError)}):d=M(v(v({},d),o[0]),{headers:v(v({},R(d.headers)||{}),R(o[0].headers)||{})})),o.length>1&&J(o[1])&&(s=M(v(v({},s),o[1]),{beforeFetch:G(e,t.beforeFetch,o[1].beforeFetch),afterFetch:G(e,t.afterFetch,o[1].afterFetch),onFetchError:G(e,t.onFetchError,o[1].onFetchError)})),ht(f,d,s)}return i}function ht(n,...e){var t;const r=typeof AbortController=="function";let i={},a={immediate:!0,refetch:!1,timeout:0};const o={method:"GET",type:"text",payload:void 0};e.length>0&&(J(e[0])?a=v(v({},a),e[0]):i=e[0]),e.length>1&&J(e[1])&&(a=v(v({},a),e[1]));const{fetch:f=(t=ce)==null?void 0:t.fetch,initialData:s,timeout:d}=a,h=ae(),u=ae(),y=ae(),C=c.ref(!1),b=c.ref(!1),z=c.ref(!1),_=c.ref(null),T=c.shallowRef(null),$=c.shallowRef(null),D=c.shallowRef(s),q=c.computed(()=>r&&b.value);let L,I;const Qe=()=>{r&&L&&L.abort()},ve=w=>{b.value=w,C.value=!w};d&&(I=rt(Qe,d,{immediate:!1}));const ee=async(w=!1)=>{var H;ve(!0),$.value=null,_.value=null,z.value=!1,L=void 0,r&&(L=new AbortController,L.signal.onabort=()=>z.value=!0,i=M(v({},i),{signal:L.signal}));const P={method:o.method,headers:{}};if(o.payload){const ne=R(P.headers);o.payloadType&&(ne["Content-Type"]=(H=ut[o.payloadType])!=null?H:o.payloadType);const re=p(o.payload);P.body=o.payloadType==="json"?JSON.stringify(re):re}let Y=!1;const N={url:p(n),options:v(v({},P),i),cancel:()=>{Y=!0}};if(a.beforeFetch&&Object.assign(N,await a.beforeFetch(N)),Y||!f)return ve(!1),Promise.resolve(null);let O=null;return I&&I.start(),new Promise((ne,re)=>{var Ye;f(N.url,M(v(v({},P),N.options),{headers:v(v({},R(P.headers)),R((Ye=N.options)==null?void 0:Ye.headers))})).then(async k=>{if(T.value=k,_.value=k.status,O=await k[o.type](),a.afterFetch&&_.value>=200&&_.value<300&&({data:O}=await a.afterFetch({data:O,response:k})),D.value=O,!k.ok)throw new Error(k.statusText);return h.trigger(k),ne(k)}).catch(async k=>{let Je=k.message||k.name;return a.onFetchError&&({data:O,error:Je}=await a.onFetchError({data:O,error:k,response:T.value})),D.value=O,$.value=Je,u.trigger(k),w?re(k):ne(null)}).finally(()=>{ve(!1),I&&I.stop(),y.trigger(null)})})},Xe=le(a.refetch);c.watch([Xe,le(n)],([w])=>w&&ee(),{deep:!0});const te={isFinished:C,statusCode:_,response:T,error:$,data:D,isFetching:b,canAbort:q,aborted:z,abort:Qe,execute:ee,onFetchResponse:h.on,onFetchError:u.on,onFetchFinally:y.on,get:j("GET"),put:j("PUT"),post:j("POST"),delete:j("DELETE"),patch:j("PATCH"),head:j("HEAD"),options:j("OPTIONS"),json:X("json"),text:X("text"),blob:X("blob"),arrayBuffer:X("arrayBuffer"),formData:X("formData")};function j(w){return(H,P)=>{if(!b.value){o.method=w,o.payload=H,o.payloadType=P,c.isRef(o.payload)&&c.watch([Xe,le(o.payload)],([N])=>N&&ee(),{deep:!0});const Y=p(o.payload);return!P&&Y&&Object.getPrototypeOf(Y)===Object.prototype&&(o.payloadType="json"),M(v({},te),{then(N,O){return ge().then(N,O)}})}}}function ge(){return new Promise((w,H)=>{nt(C).toBe(!0).then(()=>w(te)).catch(P=>H(P))})}function X(w){return()=>{if(!b.value)return o.type=w,M(v({},te),{then(H,P){return ge().then(H,P)}})}}return a.immediate&&setTimeout(ee,0),M(v({},te),{then(w,H){return ge().then(w,H)}})}function mt(n,e){return!n.endsWith("/")&&!e.startsWith("/")?`${n}/${e}`:`${n}${e}`}var We;(function(n){n.UP="UP",n.RIGHT="RIGHT",n.DOWN="DOWN",n.LEFT="LEFT",n.NONE="NONE"})(We||(We={}));var yt=Object.defineProperty,Fe=Object.getOwnPropertySymbols,pt=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable,we=(n,e,t)=>e in n?yt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,gt=(n,e)=>{for(var t in e||(e={}))pt.call(e,t)&&we(n,t,e[t]);if(Fe)for(var t of Fe(e))vt.call(e,t)&&we(n,t,e[t]);return n};gt({linear:et},{easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]});const A=n=>n===void 0;function m(n,e){const t=p(n);return A(t)?e:Number(t)}function V(n,e){const t=p(n);return Array.isArray(t)?t:t?String(t):e}function S(n,e){const t=p(n);return A(t)?e:String(t)}function W(n,e){const t=p(n);return A(t)?e:Boolean(t)}const K={src:{type:String,default:null},audioControls:{type:Boolean,default:!0},corsAnonym:{type:Boolean,default:!1},canvWidth:{type:Number,default:300},canvHeight:{type:Number,default:80},canvFillColor:{type:[String,Array],default:""},placeholder:{type:Boolean,default:!0}},F={...K,...{barWidth:{type:Number,default:5},barSpace:{type:Number,default:1},barColor:{type:[String,Array],default:"#0A0AFF"},capsHeight:{type:Number,default:0},capsDropSpeed:{type:Number,default:.9},capsColor:{type:String,default:"#A0A0FF"},brickHeight:{type:Number,default:0},brickSpace:{type:Number,default:1},symmetric:{type:Boolean,default:!1},fftSize:{type:Number,default:1024}}};function bt(){return F}class ke{constructor(e){l(this,"barColor");l(this,"barSpace");l(this,"barWidth");l(this,"brickHeight");l(this,"brickSpace");l(this,"canvFillColor");l(this,"canvHeight");l(this,"canvWidth");l(this,"capsColor");l(this,"capsDropSpeed");l(this,"capsHeight");l(this,"fftSize");l(this,"frqBits");l(this,"placeholder");l(this,"symmetric");this.barColor=V(e.barColor,F.barColor.default),this.barSpace=m(e.barSpace,F.barSpace.default),this.brickHeight=m(e.brickHeight,F.brickHeight.default),this.brickSpace=m(e.brickSpace,F.brickSpace.default),this.canvFillColor=V(e.canvFillColor,F.canvFillColor.default),this.canvHeight=m(e.canvHeight,F.canvHeight.default),this.canvWidth=m(e.canvWidth,F.canvWidth.default),this.capsColor=S(e.capsColor,F.capsColor.default),this.capsDropSpeed=m(e.capsDropSpeed,F.capsDropSpeed.default),this.capsHeight=m(e.capsHeight,F.capsHeight.default),this.fftSize=m(e.fftSize,F.fftSize.default),this.frqBits=this.fftSize>>1,this.placeholder=W(e.placeholder,F.placeholder.default),this.symmetric=W(e.symmetric,F.symmetric.default);const t=m(e.barWidth,F.barWidth.default);this.barWidth=t>this.canvWidth?this.canvWidth:t}alignSym(e){return this.symmetric?(this.canvHeight-e)/2:0}}const _e={...K,...{lineWidth:{type:Number,default:2},lineColor:{type:[String,Array],default:"#9F9"},fftSize:{type:Number,default:128}}};function Ct(){return _e}class Pe{constructor(e){l(this,"canvWidth");l(this,"canvHeight");l(this,"canvFillColor");l(this,"lineWidth");l(this,"lineColor");l(this,"fftSize");l(this,"placeholder");const t=_e;this.canvWidth=m(e.canvWidth,t.canvWidth.default),this.canvHeight=m(e.canvHeight,t.canvHeight.default),this.canvFillColor=V(e.canvFillColor,t.canvFillColor.default),this.lineWidth=m(e.lineWidth,t.lineWidth.default),this.lineColor=V(e.lineColor,t.lineColor.default),this.fftSize=m(e.fftSize,t.fftSize.default),this.placeholder=W(e.placeholder,t.placeholder.default)}}const Te={...K,...{fftSize:{type:Number,default:1024},canvWidth:{type:Number,default:100},canvHeight:{type:Number,default:100},radius:{type:Number,default:0},lineWidth:{type:Number,default:1},lineSpace:{type:Number,default:1},outlineColor:{type:String,default:"#0000FF"},outlineWidth:{type:Number,default:.3},barWidth:{type:Number,default:1},barLength:{type:Number,default:0},barColor:{type:[String,Array],default:["#FFFFFF","#0000FF"]},progress:{type:Boolean,default:!0},progressWidth:{type:Number,default:1},progressColor:{type:String,default:"#0000FF"},progressClockwise:{type:Boolean,default:!0},outlineMeterSpace:{type:Number,default:3},playtime:{type:Boolean,default:!1},playtimeFont:{type:String,default:"14px Monaco"},playtimeColor:{type:String,default:"#00f"},rotateGraph:{type:Boolean,default:!1},rotateSpeed:{type:Number,default:.001}}};function St(){return Te}let Z=1.5;class He{constructor(e){l(this,"barColor");l(this,"barLength");l(this,"barWidth");l(this,"canvFillColor");l(this,"canvHeight");l(this,"canvWidth");l(this,"fftSize");l(this,"lineSpace");l(this,"lineWidth");l(this,"outlineColor");l(this,"outlineMeterSpace");l(this,"outlineWidth");l(this,"placeholder");l(this,"playtime");l(this,"playtimeColor");l(this,"playtimeFont");l(this,"progress");l(this,"progressClockwise");l(this,"progressColor");l(this,"progressWidth");l(this,"radius");l(this,"rotateGraph");l(this,"rotateSpeed");const t=Te;this.barColor=V(e.barColor,t.barColor.default),this.barLength=m(e.barLength,t.barLength.default),this.barWidth=m(e.barWidth,t.barWidth.default),this.canvFillColor=V(e.canvFillColor,t.canvFillColor.default),this.canvHeight=m(e.canvHeight,t.canvHeight.default),this.canvWidth=m(e.canvWidth,t.canvWidth.default),this.fftSize=m(e.fftSize,t.fftSize.default),this.lineSpace=m(e.lineSpace,t.lineSpace.default),this.lineWidth=m(e.lineWidth,t.lineWidth.default),this.outlineColor=S(e.outlineColor,t.outlineColor.default),this.outlineMeterSpace=m(e.outlineMeterSpace,t.outlineMeterSpace.default),this.outlineWidth=m(e.outlineWidth,t.outlineWidth.default),this.lineWidth=m(e.lineWidth,t.lineWidth.default),this.placeholder=W(e.placeholder,t.placeholder.default),this.playtime=W(e.playtime,t.playtime.default),this.playtimeColor=S(e.playtimeColor,t.playtimeColor.default),this.playtimeFont=S(e.playtimeFont,t.playtimeFont.default),this.progress=W(e.progress,t.progress.default),this.progressClockwise=W(e.progressClockwise,t.progressClockwise.default),this.progressColor=S(e.progressColor,t.progressColor.default),this.progressWidth=m(e.progressWidth,t.progressWidth.default),this.radius=m(e.radius,t.radius.default),this.rotateGraph=W(e.rotateGraph,t.rotateGraph.default),this.rotateSpeed=m(e.rotateSpeed,t.rotateSpeed.default)}get cx(){return this.canvWidth/2}get cy(){return this.canvHeight/2}get r(){return this.radius>0?this.radius:Math.round(this.canvWidth/2*.7)}get arcStep(){return Math.ceil(this.lineWidth+this.lineSpace)}get barLen(){return this.barLength>0?this.barLength:this.canvWidth/2-this.r}get angle(){const e=()=>Z===3.5?1.5:Z+this.rotateSpeed;return Z=this.rotateGraph?e():1.5,Math.PI*Z}}const Be={...K,...{canvWidth:{type:Number,default:500},canvHeight:{type:Number,default:80},playedLineWidth:{type:Number,default:.5},playedLineColor:{type:String,default:"navy"},noplayedLineWidth:{type:Number,default:.5},noplayedLineColor:{type:String,default:"lime"},playtime:{type:Boolean,default:!0},playtimeWithMs:{type:Boolean,default:!0},playtimeFontSize:{type:Number,default:12},playtimeFontFamily:{type:String,default:"monospace"},playtimeFontColor:{type:String,default:"grey"},playtimeTextBottom:{type:Boolean,default:!1},playtimeSlider:{type:Boolean,default:!0},playtimeSliderColor:{type:String,default:"red"},playtimeSliderWidth:{type:Number,default:1},playtimeClickable:{type:Boolean,default:!0},requester:{type:Function,default:fetch}}};function Wt(){return Be}class Ft{constructor(e){l(this,"src");l(this,"canvWidth");l(this,"canvHeight");l(this,"canvFillColor");l(this,"currentTime");l(this,"duration");l(this,"playedLineWidth");l(this,"playedLineColor");l(this,"noplayedLineWidth");l(this,"noplayedLineColor");l(this,"playtime");l(this,"playtimeWithMs");l(this,"playtimeFontSize");l(this,"playtimeFontFamily");l(this,"playtimeFontColor");l(this,"playtimeTextBottom");l(this,"playtimeSlider");l(this,"playtimeSliderColor");l(this,"playtimeSliderWidth");l(this,"playtimeClickable");l(this,"peaks",[]);const t=Be;this.canvWidth=m(e.canvWidth,t.canvWidth.default),this.canvHeight=m(e.canvHeight,t.canvHeight.default),this.canvFillColor=V(e.canvFillColor,t.canvFillColor.default),this.playedLineWidth=m(e.playedLineWidth,t.playedLineWidth.default),this.playedLineColor=S(e.playedLineColor,t.playedLineColor.default),this.noplayedLineWidth=m(e.noplayedLineWidth,t.noplayedLineWidth.default),this.noplayedLineColor=S(e.noplayedLineColor,t.noplayedLineColor.default),this.playtime=W(e.playtime,t.playtime.default),this.playtimeWithMs=W(e.playtimeWithMs,t.playtimeWithMs.default),this.playtimeFontSize=m(e.playtimeFontSize,t.playtimeFontSize.default),this.playtimeFontFamily=S(e.playtimeFontFamily,t.playtimeFontFamily.default),this.playtimeFontColor=S(e.playtimeFontColor,t.playtimeFontColor.default),this.playtimeTextBottom=W(e.playtimeTextBottom,t.playtimeTextBottom.default),this.playtimeSlider=W(e.playtimeSlider,t.playtimeSlider.default),this.playtimeSliderColor=S(e.playtimeSliderColor,t.playtimeSliderColor.default),this.playtimeSliderWidth=m(e.playtimeSliderWidth,t.playtimeSliderWidth.default),this.playtimeClickable=W(e.playtimeClickable,t.playtimeClickable.default),this.src=A(e.src)?null:String(e.src),this.currentTime=0,this.duration=0}get playX(){if(!this.duration)return 0;const e=~~(this.currentTime/this.duration*this.canvWidth);return e>this.canvWidth?this.canvWidth:e}get timePlayed(){const e=[this.currentTime/3600,this.currentTime/60%60,this.currentTime%60].map(r=>String(~~r).padStart(2,"0")).join(":");if(!this.playtimeWithMs)return e;const t=~~(this.currentTime%1*1e3);return[e,String(t).padStart(3,"0")].join(".")}setPeaks(e){this.peaks.slice(0);let t=0,r=0,i=0,a=0;const o=Math.ceil(e.length/this.canvWidth),f=this.canvWidth,s=this.canvHeight;for(let d=0;d<e.numberOfChannels;d++){const h=e.getChannelData(d);for(let u=0;u<f;u++){const y=~~(u*o),C=~~(y+o);t=0,r=0;for(let b=y;b<C;b++)t=h[b]<t?h[b]:t,r=h[b]>r?h[b]:r;this.peaks[u]&&(this.peaks[u][0]=this.peaks[u][0]<r?r:this.peaks[u][0],this.peaks[u][1]=this.peaks[u][1]>t?t:this.peaks[u][1]),this.peaks[u]=[r,t]}}for(let d=0;d<this.peaks.length;d++)r=this.peaks[d][0],t=this.peaks[d][1],i=s/2-r*s/2,a=s/2-t*s/2,this.peaks[d]=[i,a===i?i+1:a]}}const Ae={...{media:{type:Object,required:!1,default:null},canvWidth:{type:Number,default:0},canvClass:{type:String,default:""},canvHeight:{type:Number,default:0},canvFillColor:{type:String,default:""},circleGradient:{type:Array,default:[[0,"palegreen"],[.3,"lime"],[.7,"limegreen"],[1,"green"]]},fftSize:{type:Number},type:{type:String,default:"wform"},frequLnum:{type:Number,default:60},frequLineCap:{type:Boolean,default:!1},frequDirection:{type:String,default:"lr"},lineColor:{type:String,default:"lime"},lineWidth:{type:Number},radius:{type:Number,default:4},connectDestination:{type:Boolean,default:!1},vbarBgColor:{type:String,default:"#e1e1e1"},vbarCaps:{type:Boolean,default:!0},vbarSpace:{type:Number,default:1},vbarWidth:{type:Number,default:4},vbarFillColor:{type:String,default:"lime"},vbarRightColor:{type:String,default:"#c0c0c0"}}};function wt(){return Ae}class he{constructor(e){l(this,"canvWidth");l(this,"canvHeight");l(this,"canvFillColor");l(this,"canvClass");l(this,"circleGradient");l(this,"fftSize");l(this,"type");l(this,"frequLnum");l(this,"frequLineCap");l(this,"frequDirection");l(this,"lineColor");l(this,"lineWidth");l(this,"radius");l(this,"connectDestination");l(this,"vbarBgColor");l(this,"vbarCaps");l(this,"vbarFillColor");l(this,"vbarRightColor");l(this,"vbarSpace");l(this,"vbarWidth");const t=Ae;this.canvFillColor=S(e.canvFillColor,t.canvFillColor.default),this.canvClass=S(e.canvClass,t.canvClass.default),this.circleGradient=A(e.circleGradient)?t.circleGradient.default:e.circleGradient,this.type=S(e.type,t.type.default),this.fftSize=A(e.fftSize)?this.type==="frequ"?1024:8192:Number(e.fftSize),this.frequLnum=m(e.frequLnum,t.frequLnum.default),this.frequLineCap=W(e.frequLineCap,t.frequLineCap.default),this.frequDirection=S(e.frequDirection,t.frequDirection.default),this.lineColor=S(e.lineColor,t.lineColor.default),this.lineWidth=A(e.lineWidth)?this.type==="frequ"?3:.5:Number(e.lineWidth),this.radius=m(e.radius,t.radius.default),this.connectDestination=W(e.connectDestination,t.connectDestination.default),this.vbarBgColor=S(e.vbarBgColor,t.vbarBgColor.default),this.vbarCaps=W(e.vbarCaps,t.vbarCaps.default),this.vbarFillColor=S(e.vbarFillColor,t.vbarFillColor.default),this.vbarRightColor=S(e.vbarRightColor,t.vbarRightColor.default),this.vbarSpace=m(e.vbarSpace,t.vbarSpace.default),this.vbarWidth=m(e.vbarWidth,t.vbarWidth.default),this.canvWidth=A(e.canvWidth)||Number(e.canvWidth)===0?this.defaultWidth:Number(e.canvWidth),this.canvHeight=A(e.canvHeight)||Number(e.canvHeight)===0?this.defaultHeight:Number(e.canvHeight)}get defaultWidth(){switch(this.type){case"vbar":return 50;case"frequ":return 300;case"circle":return 80;default:return 200}}get defaultHeight(){switch(this.type){case"vbar":return 20;case"frequ":return 80;case"circle":return 80;default:return 40}}}function me(n,e,t){let r=null,i=null,a=null;const o=e||1024,f=new Uint8Array(o/2),{pause:s,resume:d}=fe(()=>{!i||(i.getByteFrequencyData(f),t(f))},{immediate:!1});B(n,"play",()=>{const h=p(n);!h||(r||(r=new AudioContext,a=r.createMediaElementSource(h)),i=r.createAnalyser(),i.fftSize=o,a==null||a.connect(i),i.connect(r.destination),r.resume(),d())}),B(n,"pause",()=>{r==null||r.suspend(),a==null||a.disconnect(),i==null||i.disconnect(),s()})}function U(n,e){const t=c.ref(null);return c.watchEffect(()=>{const r=p(n);!r||(t.value=r.getContext("2d"),r.width=e.canvWidth,r.height=e.canvHeight)}),t}function ye(n,e,t,r){n.clearRect(0,0,e,t),r&&(n.fillStyle=pe(n,e,t,r),n.fillRect(0,0,e,t))}function pe(n,e,t,r){if(!Array.isArray(r))return r||"";const i=n.createLinearGradient(e/2,0,e/2,t);let a=0;return r.forEach(o=>{i.addColorStop(a,o),a+=1/r.length}),i}const x=Array(16).fill(0);function Le(n,e,t){const r=new ke(t);x.length=r.fftSize/2,x.fill(0);const i=U(e,r);B(n,"loadedmetadata",()=>{!r.placeholder||!i||Ne(new Uint8Array(r.fftSize/2),i,t)}),me(n,r.fftSize,a=>{Ne(a,i,t)})}function Ne(n,e,t){const r=p(e);if(!r)return;const i=new ke(t),a=Math.round((i.barWidth+i.barSpace)/i.frqBits*i.canvWidth),o=n.length;let f=0;ye(r,i.canvWidth,i.canvHeight,i.canvFillColor);for(let s=0;s<o;s++){if(s%a)continue;const d=Math.round(n.slice(s,s+a).reduce((u,y)=>y+u,0)/a),h=d/255*i.canvHeight;kt(r,i,d,s,f),r.fillStyle=pe(r,i.canvWidth,i.canvHeight,i.barColor),i.brickHeight>0?_t(r,i,h,f):r.fillRect(f,i.canvHeight-h-i.alignSym(h),i.barWidth,h),f+=i.barWidth+i.barSpace}}function kt(n,e,t,r,i){if(e.capsHeight===0)return;const a=x[r]<=t?t:x[r]-e.capsDropSpeed;x[r]=a;const o=a/255*e.canvHeight,f=e.canvHeight-o-e.capsHeight-e.alignSym(o);n.fillStyle=e.capsColor,n.fillRect(i,f,e.barWidth,e.capsHeight),e.symmetric&&n.fillRect(i,e.canvHeight-f-e.capsHeight,e.barWidth,e.capsHeight)}function _t(n,e,t,r){for(let i=0;i<t;i+=e.brickHeight+e.brickSpace)n.fillRect(r,e.canvHeight-t+i-e.alignSym(t),e.barWidth,e.brickHeight)}const Pt=["controls","src"],Oe=c.defineComponent({__name:"AVBars",props:bt(),setup(n){const e=n,t=c.ref(null),r=c.ref(null);return Le(t,r,e),(i,a)=>(c.openBlock(),c.createElementBlock(c.Fragment,null,[c.createElementVNode("audio",{ref_key:"player",ref:t,controls:e.audioControls,src:e.src},null,8,Pt),c.createElementVNode("canvas",{ref_key:"canvas",ref:r},null,512)],64))}});function Ee(n,e,t){const r=new He(t),i=U(e,r);B(n,"loadedmetadata",()=>{Ht(i,r)}),me(n,r.fftSize,a=>{Tt(a,i,n,new He(t))})}function Tt(n,e,t,r){const i=p(e);if(!i)return;const a=p(t);if(!a)return;const o=n.length,f=(r.lineWidth+r.lineSpace)/o*(2*Math.PI);ye(i,r.canvWidth,r.canvHeight,r.canvFillColor),Me(i,r),Bt(i,a,r),At(i,a,r),i.lineWidth=r.barWidth,i.strokeStyle=Lt(i,r);let s=r.angle;for(let d=0;d<o;d++){if(s+=f,d%r.arcStep)continue;const h=Math.round(n.slice(d,d+r.arcStep).reduce((y,C)=>C+y,0)/r.arcStep),u=r.r+h/255*r.barLen;i.beginPath(),i.moveTo(r.r*Math.cos(s)+r.cx,r.r*Math.sin(s)+r.cy),i.lineTo(u*Math.cos(s)+r.cx,u*Math.sin(s)+r.cy),i.stroke()}}function Ht(n,e){const t=p(n);!t||(Me(t,e),ze(t,"0:00",e))}function Me(n,e){e.outlineWidth!==0&&(n.beginPath(),n.strokeStyle=e.outlineColor,n.lineWidth=e.outlineWidth,n.arc(e.cx,e.cy,e.r,0,2*Math.PI),n.stroke())}function Bt(n,e,t){if(!t.progress)return;const{currentTime:r,duration:i}=e,a=r/i*2*Math.PI,o=Math.PI*1.5+a;!a||(n.lineWidth=t.progressWidth,n.strokeStyle=t.progressColor,n.beginPath(),n.arc(t.cx,t.cy,t.r-t.outlineWidth-t.outlineMeterSpace,1.5*Math.PI,o,t.progressClockwise),n.stroke())}function At(n,e,t){const{currentTime:r}=e,i=Math.floor(r/60),a=Math.floor(r)%60,o=a<10?`0${a}`:`${a}`,f=`${i}:${o}`;ze(n,f,t)}function ze(n,e,t){n.font=t.playtimeFont,n.fillStyle=t.playtimeColor,n.textAlign="center",n.fillText(e,t.cx,t.cy+parseInt(t.playtimeFont)*.25)}function Lt(n,e){if(!Array.isArray(e.barColor))return e.barColor;const t=n.createRadialGradient(e.cx,e.cy,e.canvWidth/2,e.cx,e.cy,0);let r=0;return e.barColor.forEach(i=>{t.addColorStop(r,i),r+=1/e.barColor.length}),t}const Nt=["controls","src"],De=c.defineComponent({__name:"AVCircle",props:St(),setup(n){const e=n,t=c.ref(null),r=c.ref(null);return Ee(t,r,e),(i,a)=>(c.openBlock(),c.createElementBlock(c.Fragment,null,[c.createElementVNode("audio",{ref_key:"player",ref:t,controls:e.audioControls,src:e.src},null,8,Nt),c.createElementVNode("canvas",{ref_key:"canvas",ref:r},null,512)],64))}});function qe(n,e,t){const r=new Pe(t),i=U(e,r);c.watch(i,()=>{!r.placeholder||!p(i)||Ve(new Uint8Array(r.fftSize),i,r)}),me(n,r.fftSize,a=>{Ve(a,i,new Pe(t))})}function Ve(n,e,t){const r=p(e);if(!r)return;const i=t.canvWidth,a=t.canvHeight,o=t.lineWidth,f=n.length,s=~~i/2/f;let d=0;const h=()=>{let u=0;for(let y=0;y<f;y++){const C=n[y];u=a*(255-C)/510,y%2&&(u=a-u),r.lineTo(d,u),d+=s}return d};ye(r,i,a,t.canvFillColor),r.lineWidth=o,r.strokeStyle=pe(r,i,a,t.lineColor),r.beginPath(),n.reverse(),r.moveTo(d,a/2),d=h(),n.reverse(),h(),r.lineTo(i,a/2),r.stroke()}const Ot=["controls","src"],$e=c.defineComponent({__name:"AVLine",props:Ct(),setup(n){const e=n,t=c.ref(null),r=c.ref(null);return qe(t,r,e),(i,a)=>(c.openBlock(),c.createElementBlock(c.Fragment,null,[c.createElementVNode("audio",{ref_key:"player",ref:t,controls:e.audioControls,src:e.src},null,8,Ot),c.createElementVNode("canvas",{ref_key:"canvas",ref:r},null,512)],64))}});function Ie(n,e,t,r={}){const i=new Ft(t),a=U(e,i);Et(a,i,r);const{pause:o,resume:f}=fe(()=>{var s,d;i.currentTime=(d=(s=n==null?void 0:n.value)==null?void 0:s.currentTime)!=null?d:0,Q(a,i)},{immediate:!1});B(n,"play",f),B(n,"pause",o),B(n,"ended",()=>{const s=p(n);!s||s.duration===i.duration||(i.duration=s.duration,Q(a,i))}),B(n,"timeupdate",()=>{const s=p(n);!s||(i.currentTime=s.currentTime,Q(a,i))}),B(e,"click",s=>{if(!i.playtimeClickable)return;const d=p(n);!d||(d.currentTime=s.offsetX/i.canvWidth*i.duration,i.currentTime=d.currentTime,Q(a,i))})}function Q(n,e){const t=p(n);if(!t)return;let r=0;t.clearRect(0,0,e.canvWidth,e.canvHeight);const i=(a,o,f,s)=>{for(t.lineWidth=f,t.strokeStyle=s,o=o>e.peaks.length?e.peaks.length:o,t.beginPath();a<o;a++)t.moveTo(a,e.peaks[a][0]),t.lineTo(a,e.peaks[a][1]);return t.stroke(),a};r=i(r,e.playX,e.playedLineWidth,e.playedLineColor),i(r,e.peaks.length,e.noplayedLineWidth,e.noplayedLineColor),je(t,e),e.playtime&&Ge(t,e)}function je(n,e){n.lineWidth=e.playtimeSliderWidth,n.strokeStyle=e.playtimeSliderColor,n.beginPath(),n.moveTo(e.playX,0),n.lineTo(e.playX,e.canvHeight),n.stroke()}function Ge(n,e){const t=e.timePlayed,r=3,i=~~n.measureText(t).width,a=e.playX>e.canvWidth-i-r?e.playX-i-r:e.playX+r,o=e.playtimeTextBottom?e.canvHeight-e.playtimeFontSize+r:e.playtimeFontSize+r;n.fillStyle=e.playtimeFontColor,n.font=`${e.playtimeFontSize}px ${e.playtimeFontFamily}`,n.fillText(t,a,o)}function Et(n,e,t){if(!e.src)return;ft(t)(e.src).arrayBuffer().then(({error:i,data:a})=>{const o=p(i);if(o!==null){console.error(`Failed get url '${e.src}': ${o}`);return}if(a.value===null){console.error("invalid arrayBuffer data received");return}new AudioContext().decodeAudioData(a.value).then(s=>{e.duration=s.duration,e.setPeaks(s),Q(n,e)}).catch(s=>{console.error("Failed to decode audio array buffer:",s)})}),c.watchEffect(()=>{const i=p(n);!i||(i.lineWidth=e.noplayedLineWidth,i.strokeStyle=e.noplayedLineColor,i.beginPath(),i.moveTo(0,e.canvHeight/2),i.lineTo(e.canvWidth,e.canvHeight/2),i.stroke(),je(i,e),e.playtime&&Ge(i,e))})}const Mt=["controls","src"],Re=c.defineComponent({__name:"AVWaveform",props:Wt(),setup(n){const e=n,t=c.ref(null),r=c.ref(null);return Ie(t,r,e,{options:{refetch:!0},fetchOptions:{mode:"cors"}}),(i,a)=>(c.openBlock(),c.createElementBlock(c.Fragment,null,[c.createElementVNode("audio",{ref_key:"player",ref:t,controls:e.audioControls,src:e.src},null,8,Mt),c.createElementVNode("canvas",{ref_key:"canvas",ref:r},null,512)],64))}});function Ue(n,e){const t=e;let r;const i=U(n,new he(t)),{pause:a,resume:o}=fe(()=>{!r||Dt(r,i,new he(t))},{immediate:!1});c.watchEffect(()=>{const f=p(t.media);f?(r=zt(f,new he(t)),o()):a()})}function zt(n,e){const t=new AudioContext,r=t.createAnalyser();return t.createMediaStreamSource(n).connect(r),r.fftSize=e.fftSize,e.connectDestination&&r.connect(t.destination),r}function Dt(n,e,t){const r=p(e);if(!r)return;const i=new Uint8Array(n.fftSize);switch(t.canvFillColor&&(r.fillStyle=t.canvFillColor),r.clearRect(0,0,t.canvWidth,t.canvHeight),r.beginPath(),r.strokeStyle=t.lineColor,t.type){case"frequ":n.getByteFrequencyData(i),qt(i,r,t);break;case"circle":n.getByteFrequencyData(i),$t(i,r,t);break;case"vbar":n.getByteFrequencyData(i),Vt(i,r,t);break;default:n.getByteTimeDomainData(i),It(i,r,t);break}}function qt(n,e,t){const r=t.frequDirection==="mo",i=r?t.canvWidth/2:0,a=r?t.frequLnum/2:t.frequLnum,o=r?t.canvWidth/a/2:t.canvWidth/a,f=t.canvHeight,s=t.lineWidth||2;for(let d=0;d<a;d++){const h=r?d*o:d*o+s,u=n.slice(h,h+o).reduce((C,b)=>C+b/255*f,0)/o,y=(f-u)/2+2;e.lineWidth=s,e.lineCap=t.frequLineCap?"round":"butt",e.moveTo(i+h,y),e.lineTo(i+h,f-y),e.stroke(),r&&d>0&&(e.moveTo(i-h,y),e.lineTo(i-h,f-y),e.stroke())}}function Vt(n,e,t){const r=t.vbarWidth,i=t.vbarSpace,a=r<5?5:r/2;let o=0;for(let s=0;s<n.length;s++)o=o<n[s]?n[s]:o;const f=o/255*t.canvWidth;e.lineWidth=t.vbarWidth,e.lineCap=t.vbarCaps?"round":"butt",e.fillStyle=t.vbarBgColor,e.fillRect(0,0,t.canvWidth,t.canvHeight);for(let s=r/2;s+r+i<=t.canvWidth;s=s+r+i)e.strokeStyle=s>f?t.vbarRightColor:t.vbarFillColor,e.beginPath(),e.moveTo(s,a),e.lineTo(s,t.canvHeight-a),e.stroke()}function $t(n,e,t){const r=t.canvWidth/2,i=t.canvHeight/2,a=r<i?r:i,f=Math.max(...n)/255*a,s=e.createRadialGradient(r,i,0,r,i,f);for(const[d,h]of t.circleGradient)s.addColorStop(d,h);e.fillStyle=s,e.arc(r,i,f,0,2*Math.PI),e.fill("evenodd")}function It(n,e,t){const r=t.canvHeight,i=t.canvWidth/t.fftSize;let a=0;e.lineWidth=t.lineWidth||.5;for(let o=0;o<n.length;o++){const s=n[o]/255*r;e.lineTo(a,s),a+=i}e.stroke()}const xe=c.defineComponent({__name:"AVMedia",props:wt(),setup(n){const e=n,t=c.ref(null);return Ue(t,e),(r,i)=>(c.openBlock(),c.createElementBlock("canvas",{ref_key:"canvas",ref:t},null,512))}}),jt={install(n){n.component("av-bars",Oe),n.component("av-circle",De),n.component("av-line",$e),n.component("av-waveform",Re),n.component("av-media",xe)}};g.AVBars=Oe,g.AVCircle=De,g.AVLine=$e,g.AVMedia=xe,g.AVPlugin=jt,g.AVWaveform=Re,g.useAVBars=Le,g.useAVCircle=Ee,g.useAVLine=qe,g.useAVMedia=Ue,g.useAVWaveform=Ie,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
